<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>語彙タイムアタック</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", sans-serif; max-width: 900px; margin: 24px auto; padding: 0 12px; }
    h2 { margin: 18px 0 8px; } h3 { margin: 12px 0 6px; }
    button { padding: 10px 14px; margin: 6px 6px 0 0; cursor: pointer; }
    input, select { padding: 9px; width: 280px; max-width: 100%; }
    label { margin-right: 6px; }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .box { border:1px solid #ddd; padding:14px; border-radius:12px; margin-top:10px; background:#fff; }
    .muted { color:#666; font-size:12px; }
    .ok { color:#0a7; font-weight:700; }
    .ng { color:#c33; font-weight:700; }
    hr { border:none; border-top:1px solid #eee; margin:16px 0; }
    .grid2 { display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    @media (max-width:720px){ .grid2{ grid-template-columns:1fr; } }
    ol { margin:6px 0 0 20px; }
    #q h3 { margin:0 0 6px; }

    /* タイムアタックUI */
    .hud { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .stat { border:1px solid #eee; padding:8px 10px; border-radius:10px; background:#fafafa; }
    .big { font-size:18px; font-weight:800; }
    .danger { color:#c33; }
    .effect { margin-top:10px; font-size:20px; font-weight:900; }
    .hidden { display:none !important; }
    .center { text-align:center; }
  </style>
  <link rel="manifest" href="./manifest.webmanifest">
  <meta name="theme-color" content="#111827">

  <!-- iPhone用（これがあるとアイコンが綺麗） -->
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

</head>

<body>
  <h2>ログイン</h2>
  <div class="box">
    <div class="row">
      <div>
        <div class="muted">ID（例 G2-C03-015）</div>
        <input id="loginId" value="G2-C03-015" autocomplete="username" />
      </div>
      <div>
        <div class="muted">パスワード</div>
        <input id="password" type="password" value="TestPass123!" autocomplete="current-password" />
      </div>
    </div>
    <div class="row" style="margin-top:8px;">
      <button id="loginBtn">ログイン</button>
      <button id="logoutBtn" style="display:none;">ログアウト</button>
      <span id="loginMsg" class="muted"></span>
      <span id="modeBadge" class="muted" style="margin-left:auto;"></span>
    </div>
  </div>

  <h2>タイムアタック（30秒）</h2>
  <div class="box">
    <div id="startPane">
      <div class="center">
        <div class="muted">30秒で何問正解できるか勝負！</div>

   <div class="row center" style="margin:10px 0;">
     <label>難易度：</label>
     <select id="levelSelect">
       <option value="all">すべて</option>
       <option value="1">初級</option>
       <option value="2">中級</option>
       <option value="3">上級</option>
     </select>
   </div>

        <button id="startBtn" class="big">▶ START</button>
      </div>
    </div>

    <div id="battlePane" class="hidden">
      <div class="hud">
        <div class="stat">残り <span id="timeLeft" class="big">30</span> 秒</div>
        <div class="stat">スコア <span id="scoreNow" class="big">0</span></div>
        <div class="stat">COMBO <span id="comboNow" class="big">0</span></div>
        <div class="stat muted">連続正解 <span id="streak">0</span></div>
      </div>

      <div id="q" style="margin-top:12px;"></div>
      <div id="choices" class="row" style="margin-top:8px;"></div>

      <div id="effect" class="effect"></div>
      <div id="result" class="muted" style="margin-top:10px;"></div>

      <div class="row" style="margin-top:10px;">
        <button id="stopBtn">終了（途中でも）</button>
      </div>
    </div>

    <div id="resultPane" class="hidden">
      <h3>リザルト</h3>
      <div id="resultSummary" class="box" style="border-style:dashed;"></div>
      <div class="row">
        <button id="retryBtn">もう一回！</button>
        <button id="goRankBtn">ランキングを見る</button>
      </div>
    </div>
  </div>

  <h2>ランキング</h2>
  <div class="box" id="rankBox">
    <div class="row">
      <label>週を選ぶ：</label>
      <select id="weekSelect" disabled></select>
      <button id="rankBtn" disabled>ランキングを読み込む</button>
      <span id="rankMsg" class="muted"></span>
    </div>

    <div class="grid2" style="margin-top:10px;">
      <div>
        <h3>週Top10（個人）</h3>
        <ol id="weeklyTop"></ol>
      </div>
      <div>
        <h3>累計Top10（個人）</h3>
        <ol id="totalTop"></ol>
      </div>
    </div>

    <h3>あなたの順位</h3>
    <div id="myRank" class="muted">（ランキングを読み込むと表示）</div>

    <hr />

    <div class="grid2">
      <div>
        <h3>クラス対抗 週Top10（合計）</h3>
        <ol id="classWeeklyTop"></ol>
      </div>
      <div>
        <h3>クラス対抗 累計Top10（合計）</h3>
        <ol id="classTotalTop"></ol>
      </div>
      <div>
        <h3>クラス対抗 週Top10（平均）</h3>
        <ol id="classWeeklyAvgTop"></ol>
      </div>
      <div>
        <h3>クラス対抗 累計Top10（平均）</h3>
        <ol id="classTotalAvgTop"></ol>
      </div>
    </div>
  </div>

  <!-- JS読み込み（順番が超重要） -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./js/config.js"></script>
  <script src="./js/api.js"></script>
  <script src="./js/ranking.js"></script>
  <script src="./js/quiz.js"></script>
  <script src="./js/main.js"></script>
  <script>
  // Service Worker 登録（localhostでもOK）
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", async () => {
      try {
        const reg = await navigator.serviceWorker.register("./sw.js");
        console.log("[pwa] SW registered:", reg.scope);
      } catch (e) {
        console.warn("[pwa] SW register failed:", e);
      }
    });
  }
  <script>
   // PWA: Service Worker登録（HTTPSかlocalhostで動く）
   if ("serviceWorker" in navigator) {
    window.addEventListener("load", async () => {
      try {
        const reg = await navigator.serviceWorker.register("./sw.js");
        console.log("[pwa] SW registered:", reg.scope);
      } catch (e) {
        console.warn("[pwa] SW register failed:", e);
      }
    });
  }
  
</script>

<audio id="bgm" loop preload="auto"></audio>
<audio id="sfxOk" preload="auto"></audio>
<audio id="sfxNg" preload="auto"></audio>
<audio id="sfxGo" preload="auto"></audio>

</body>
</html>
